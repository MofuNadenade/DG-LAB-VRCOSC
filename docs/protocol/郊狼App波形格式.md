# 郊狼App波形格式

## 概述

.pulse 文件是 DG-LAB 官方在 3.4.4 版本开放的波形文件格式，用于存储和分享波形数据。文件采用文本格式，结构如下：

```
Dungeonlab+pulse:波形描述=小节描述+section+...+section+小节描述
```

### 文件结构

**波形描述部分**：`休息时长,速度倍率,未知参数`
- 位于文件开头，以 `Dungeonlab+pulse:` 标识
- 三个参数用逗号分隔，以 `=` 结束

**小节描述部分**：`频率A,频率B,小节时长,频率模式,小节开关/脉冲数据`
- 每个小节包含5个基础参数，用逗号分隔
- 脉冲数据以 `,` 分隔，格式为 `强度-脉冲类型,强度-脉冲类型,...`
- 多个小节用 `+section+` 连接

## 波形描述

这一部分声明了整个波形的休息时长、播放速率

### 休息时长

在播放完最多 10 个小节后，可以设置一段休息时长作为这一波形模式的结束。

此处记录的是滑块值，与真实值（单位 s）的映射关系为线性的 0.1 倍，即 10 代表 1s

### 速度倍率

波形的播放速度倍率，可接受的值为 1, 2, 4

### 尚不明确

（未进行更多测试）该参数的作用尚不明确，值默认情况下为 16，可取其他值

## 小节描述

该部分描述小节的形状和包括频率模式在内的特性，每个波形至多可拥有 10 个小节，小节与小结见使用 +section+ 分隔

### 频率A

控制这一小节中脉冲的频率，单位是 ms，10ms=100hz，20ms=50hz

这一参数描述了该小节频率的变化初值，取值范围 0 至 83

### 频率B

控制这一小节中脉冲的频率，单位是 ms，10ms=100hz，20ms=50hz

这一参数描述了该小节频率的变化终值，取值范围 0 至 83（此参数在频率模式"固定"下失效）

频率滑块值与真实值（单位 ms）的关系符合以下数组：

```javascript
const FREQ_SLIDER_VALUE_MAP = [
  10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
  50, 52, 54, 56, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78,
  80, 85, 90, 95,
  100, 110, 120, 130, 140, 150, 160, 170, 180, 190,
  200, 233, 266, 300, 333, 366,
  400, 450, 500, 550,
  600, 700, 800, 900, 1000
]
```

### 小节时长

控制每个小节的时长，脉冲元总是会重复完整个循环之后再停止，因此即使你设置小节时长为1.0s，当脉冲元长0.7s时本小节也会循环两次，也就是输出1.4s

这一参数描述了该小节总时长的滑块值，取值范围 0 至 99

频率滑块值与真实值（单位 s）的关系符合以下数组：

```javascript
const SECTION_TIME_MAP = [
  0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 2.9, 3, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 3.8, 3.9, 4, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9,
  5, 5.2, 5.4, 5.6, 5.8, 6, 6.2, 6.4, 6.6, 6.8, 7, 7.2, 7.4, 7.6, 7.8,
  8, 8.5, 9, 9.5,
  10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
  20, 23.4, 26.6, 30, 33.4, 36.6,
  40, 45, 50, 55,
  60, 70, 80, 90,
  100, 120, 140, 160, 180,
  200, 250, 300
];
```

### 频率模式

这一参数描述了该小节频率的变化规律，以下为官方解释，取值从 1 至 4

- "固定"情况下，本小节的全部持续时间内频率恒定为 频率A；
- "节内渐变"情况下，本小节的全部持续时间内频率会逐渐从第一个设定值渐变到第二个设定值；
- "元内渐变"情况下，本小节每个脉冲元的持续时间内频率逐渐从第一个设定值渐变到第二个设定值，也就是频率在每个脉冲元内周期性变化；
- "元间渐变"情况下，本小节每个脉冲元内部的频率是固定的，但是第一个脉冲元的频率到最后一个脉冲元的频率会从第一个设定值渐变到第二个设定值。

### 小节开关

该参数标识该小节的开关状态，0 表示禁用，1 表示启用

## 脉冲元形状

描述脉冲元的形状，脉冲元由最少两根"竖条"组成，每根竖条代表0.1s的输出强度，也就是每个脉冲元的最短长度为0.2秒。一个小节由多个脉冲元重复播放组成，重复播放时间由小节时长决定。

每个脉冲元由多个 强度-脉冲类型 脉冲构成

### 脉冲强度

该参数描述了该脉冲的强度，取值 0 至 100

### 脉冲类型

该参数描述了该脉冲的类型，0 表示普通脉冲（不可编辑），1 表示锚点脉冲（可编辑）

锚点脉冲间的普通脉冲的值可由锚点脉冲自动计算得出，因此是不可编辑的